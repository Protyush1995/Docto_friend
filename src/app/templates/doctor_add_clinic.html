<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Add Clinic</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root{
      --primary: #4d20cab8;
      --bg: #f6f8ff;
      --card-bg: #ffffff;
      --muted: #6b7280;
      --accent: #0b63ff;
      --card-shadow: 0 10px 30px rgba(0,64,255,0.08);
      --input-shadow: 0 6px 18px rgba(0,64,255,0.06);
      --border-radius: 12px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 400px at 10% 10%, rgba(0,64,255,0.06), transparent 10%),
                  linear-gradient(180deg, var(--bg), #ffffff 60%);
      color:#0b1226;
      padding:24px;
    }

    .container{ max-width:1000px; margin:0 auto; }

    header
    {
      display:flex;
      align-items:center;
      justify-content:space-between; /* brand left, navigation right */
      gap:16px;
      margin-bottom:20px;
    }

    /* left column (brand) */
    .brand
    {
      display:flex;
      align-items:center;
      gap:12px;
    }

    /* right column (navigation) */
    .navigation
    {
      display:flex;
      align-items:center;
      justify-content:flex-end; /* right-align nav items inside nav container */
      gap:10px;
      /*width:100%;           ensure it can take remaining space if needed */
      max-width:600px;     /* optional, remove or adjust as desired */
    }

    .logo {
      width:56px; height:56px; border-radius:10px;
      background:linear-gradient(135deg,var(--primary),#0066ff);
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:700; box-shadow: var(--card-shadow);
      font-size:20px;
    }

    h1{ margin:0; font-size:20px; color:var(--primary); }
    .sub { color:var(--muted); font-size:13px; margin-top:4px; }

    .card{
      background:var(--card-bg);
      border-radius:var(--border-radius);
      padding:20px;
      box-shadow:0 2px 6px rgba(0, 0, 0, 0.545);
      border:1px solid rgba(0,64,255,0.06);
    }

    form{ display:flex; flex-direction:column; gap:16px; }
    label{ font-size:14px; color:var(--muted); margin-bottom:4px; font-weight: bold; }

    input, textarea{
      padding:8px;
      border-radius:6px;
      border:1px solid rgba(5, 11, 30, 0.678);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.545);
      font-size:13px;
      width:100%;
    }

    .btn {
      padding:10px 14px; border-radius:8px; border:none; cursor:pointer;
      background:linear-gradient(180deg,var(--primary),#0033cc); color:#fff; font-weight:600;
      font-size:14px;
    }

    /* ---------------------- NEW SCHEDULING GRID ---------------------- */

    .schedule-grid {
      display: grid;
      grid-template-columns: 120px repeat(7, 1fr);
      gap: 6px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-top: 10px;
    }

    .day {
      text-align: center;
      font-weight: 600;
      color: var(--primary);
      padding-bottom: 8px;
      font-size: 14px;
    }

    .time-col {
      font-weight: 600;
      color: var(--muted);
      display: flex;
      align-items: center;
      font-size: 13px;
    }

    .slot {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .slot input {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .schedule-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .small-btn {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: var(--primary);
      color: white;
      font-size: 12px;
      font-weight: 600;
    }

    .small-btn.clear {
      background: #d32f2f;
    }

  </style>
</head>

<body>
  <div class="container">

<!-- UPDATED HEADER --> 
<header> 
  <div class="brand"> 
    <div class="logo">DD</div> 
    <div> <h1>Add Clinic</h1> 
      <div class="sub">Fill out the form to register a new clinic</div>
     </div> 
  </div>
  <div class="navigation"> 
    <a href="/doc_dashboard/{{ username }}" class="btn ghost">Home</a> 
  </div>
</header>

    <section class="card">
      <form method="POST" action="/doctor-clinic-seeding">

        <div>
          <h3 style="color:var(--primary);">Clinic Name</h3>
          <input type="text" id="clinicName" name="clinicName" placeholder="eg : Doctopal Clinic" required>
        </div>

        <h3 style="color:var(--primary);">Clinic Address</h3>

        <div style="display:flex; gap:12px;">
          <div style="flex:1"><label>House No</label><input type="text" name="houseNo" required></div>
          <div style="flex:1"><label>Street</label><input type="text" name="street" required></div>
        </div>

        <div style="display:flex; gap:12px;">
          <div style="flex:1"><label>Post Office</label><input type="text" name="postOffice" required></div>
          <div style="flex:1"><label>Police Station</label><input type="text" name="policeStation" required></div>
        </div>

        <div style="display:flex; gap:12px;">
          <div style="flex:1"><label>City</label><input type="text" name="city" required></div>
          <div style="flex:1"><label>Pin Code</label><input type="text" name="pinCode" required></div>
        </div>

        <div style="display:flex; gap:12px;">
          <div style="flex:1"><label>State</label><input type="text" name="state" required></div>
          <div style="flex:1"><label>Country</label><input type="text" name="country" required></div>
        </div>
        
        <div style="display:flex; gap:12px;">
          <div style="flex:1"><label>Contact Number</label><input type="tel" name="clinicContact" id="clinicContact" required></div>
          <div style="flex:1"><label>Alternative Contact Number</label><input type="tel" name="clinicContactAlt" id="clinicContactAlt" ></div>
        </div>

        <div>
          <label for="clinicemail">Email address</label>
          <input type="email" id="clinicemail" name="clinicemail" placeholder="eg : doctopal_clinic@gmail.com" >
        </div>

        <div>
          <label for="clinicFees">Consultation Fees</label>
          <input type="number" id="clinicFees" name="clinicFees" required>
        </div> 

        <h3 style="color:var(--primary); margin-top:20px;">Visit Schedule</h3>
       
        <!-- Schedule builder controls -->
        <div style="margin-top:18px;">
          <h3 style="color:var(--primary); margin-bottom:8px;">Visit Schedule</h3>

          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <label for="sched_day">Day</label>
            <select id="sched_day" name="sched_day">
              <option value="mon">Monday</option><option value="tue">Tuesday</option><option value="wed">Wednesday</option>
              <option value="thu">Thursday</option><option value="fri">Friday</option><option value="sat">Saturday</option>
              <option value="sun">Sunday</option>
            </select>

            <label for="sched_start">Start time</label>
            <select id="sched_start" name="sched_start"></select>

            <label for="sched_end">End time</label>
            <select id="sched_end" name="sched_end"></select>

            <button type="button" id="sched_add" class="btn" style="margin-left:8px;">Add</button>
            <button type="button" id="sched_clear" class="btn small-btn clear">Clear All</button>
          </div>

          <input type="hidden" id="schedule_json" name="schedule_json" value="">

          <div style="margin-top:12px;">
            <table id="schedule_table" style="width:100%; border-collapse:collapse;">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid rgba(0,0,0,0.08);">
                  <th style="padding:8px">Day</th>
                  <th style="padding:8px">Start</th>
                  <th style="padding:8px">End</th>
                  <th style="padding:8px">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <script>
          (function(){
            const startHour = 8, endHour = 20; // 08:00..20:00
            const pad = n => String(n).padStart(2,'0');
            function timeLabel(h){ return `${(h%12===0?12:h%12)}:00 ${h<12?'AM':'PM'}`; }
            function isoTime(h){ return `${pad(h)}:00`; }

            const startSel = document.getElementById('sched_start');
            const endSel = document.getElementById('sched_end');
            const daySel = document.getElementById('sched_day');
            const addBtn = document.getElementById('sched_add');
            const clearBtn = document.getElementById('sched_clear');
            const tableBody = document.querySelector('#schedule_table tbody');
            const hidden = document.getElementById('schedule_json');

            // populate time selects (1-hour intervals)
            for(let h = startHour; h <= endHour; h++){
              const opt1 = document.createElement('option');
              opt1.value = isoTime(h);
              opt1.textContent = timeLabel(h);
              startSel.appendChild(opt1);

              const opt2 = document.createElement('option');
              opt2.value = isoTime(h);
              opt2.textContent = timeLabel(h);
              endSel.appendChild(opt2);
            }

            // internal schedule representation: { mon: {start:'08:00', end:'12:00'}, ... }
            const schedule = {};

            function renderTable(){
              tableBody.innerHTML = '';
              const order = ['mon','tue','wed','thu','fri','sat','sun'];
              const labels = {mon:'Monday', tue:'Tuesday', wed:'Wednesday', thu:'Thursday', fri:'Friday', sat:'Saturday', sun:'Sunday'};
              for(const d of order){
                const row = document.createElement('tr');
                const cellDay = document.createElement('td');
                cellDay.style.padding = '8px';
                cellDay.textContent = labels[d];
                row.appendChild(cellDay);

                const cellStart = document.createElement('td');
                cellStart.style.padding = '8px';
                cellStart.textContent = (schedule[d] ? schedule[d].start : '—');
                row.appendChild(cellStart);

                const cellEnd = document.createElement('td');
                cellEnd.style.padding = '8px';
                cellEnd.textContent = (schedule[d] ? schedule[d].end : '—');
                row.appendChild(cellEnd);

                const cellActions = document.createElement('td');
                cellActions.style.padding = '8px';
                if(schedule[d]){
                  const del = document.createElement('button');
                  del.type = 'button';
                  del.textContent = 'Delete';
                  del.className = 'small-btn';
                  del.style.marginRight = '6px';
                  del.addEventListener('click', ()=>{ delete schedule[d]; renderTable(); syncHidden(); });
                  
                  cellActions.appendChild(del);
                } else {
                  cellActions.textContent = '';
                }
                row.appendChild(cellActions);

                tableBody.appendChild(row);
              }
            }

            function parseHM(t){ const [hh,mm]=t.split(':').map(Number); return hh*60+mm; }

            function syncHidden(){
              // convert to output format: { mon: ["08:00-12:00"], ... } (list to allow future multiple ranges)
              const out = {};
              for(const k in schedule) out[k] = [`${schedule[k].start}-${schedule[k].end}`];
              hidden.value = JSON.stringify({ schedule: out, doctor_id: (document.getElementById('doctor_id') ? document.getElementById('doctor_id').value : null) });
            }

            addBtn.addEventListener('click', ()=>{
              const day = daySel.value;
              const start = startSel.value;
              const end = endSel.value;

              if(!day){ alert('Select a day.'); return; }
              if(!start || !end){ alert('Select start and end times.'); return; }

              if(parseHM(end) <= parseHM(start)){
                alert('End time must be later than start time.');
                return;
              }

              // optional: merge or reject overlapping; here we simply replace existing day entry
              schedule[day] = { start, end };
              renderTable();
              syncHidden();
            });

            clearBtn.addEventListener('click', ()=>{
              for(const k in schedule) delete schedule[k];
              renderTable();
              syncHidden();
            });

            // initialize table (in case server provided existing schedule in a hidden var)
            (function initFromServer(){
              try{
                // if server injected existing schedule json in a hidden input or global var, parse it
                const existing = document.getElementById('schedule_json_initial');
                let initial = null;
                if(existing && existing.value) initial = JSON.parse(existing.value);
                else if(window.INIT_SCHEDULE) initial = window.INIT_SCHEDULE;
                if(initial && initial.schedule){
                  for(const [k, ranges] of Object.entries(initial.schedule)){
                    if(Array.isArray(ranges) && ranges.length){
                      // take first range "HH:MM-HH:MM"
                      const [s,e] = ranges[0].split('-');
                      schedule[k] = { start: s, end: e };
                    }
                  }
                  renderTable();
                  syncHidden();
                }
              }catch(err){ /* ignore parse errors */ }
            })();

            // final sync to ensure hidden has something
            renderTable();
            syncHidden();
          })();
          </script>
          </div>
        </div>

        <button type="submit" class="btn">Submit</button>

      </form>
    </section>

  </div>



</body>
</html>
